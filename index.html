<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Simple Music Player</title>
  <style>
    :root{--bg:#0f1724;--card:#0b1220;--accent:#1db954;--muted:#9aa4b2;color-scheme:dark}
    *{box-sizing:border-box;font-family:Inter,Segoe UI,Roboto,Arial,sans-serif}
    body{margin:0;min-height:100vh;background:linear-gradient(180deg,#071020 0%,#081826 100%);display:flex;align-items:center;justify-content:center;padding:24px}
    .player{width:min(900px,96vw);background:var(--card);border-radius:12px;padding:20px;color:#e6eef6;box-shadow:0 8px 30px rgba(2,6,23,.6)}
    .top{display:flex;gap:20px}
    .cover{width:160px;height:160px;background:linear-gradient(135deg,#0b2233,#122b3d);border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:12px;color:var(--muted)}
    .meta{flex:1}
    .title{font-size:20px;font-weight:600;margin:0}
    .artist{color:var(--muted);margin:6px 0 14px}
    .controls{display:flex;align-items:center;gap:12px}
    button{background:transparent;border:0;color:inherit;padding:8px;border-radius:8px;cursor:pointer}
    button:hover{background:rgba(255,255,255,.03)}
    .big{font-size:22px;padding:12px}
    .progress{height:8px;background:rgba(255,255,255,.06);border-radius:8px;position:relative;cursor:pointer}
    .bar{height:100%;background:linear-gradient(90deg,var(--accent),#0af);width:0;border-radius:8px}
    .time{display:flex;justify-content:space-between;font-size:12px;color:var(--muted);margin-top:6px}
    .playlist{margin-top:0;display:grid;gap:8px}
    .track{padding:10px;border-radius:8px;display:flex;align-items:center;gap:12px;cursor:pointer}
    .track:hover{background:rgba(255,255,255,.02)}
    .track.active{background:linear-gradient(90deg,rgba(29,185,84,.12),rgba(10,150,200,.06));outline:1px solid rgba(29,185,84,.12)}
    /* make playlist items stretch so the file type (e.g. MP3) sits in a straight column at the right */
    .track{ justify-content:space-between; }
    .track .info{ flex:1; margin:0 12px; min-width:0; } /* allow text truncation if needed */
    .filetype{ flex:0 0 60px; text-align:right; color:var(--muted); font-size:12px; }

    /* DAILY BEST and combined tracks box */
    .tracks-box{
      margin-top:18px;
      padding:18px;
      border-radius:12px;
      background:linear-gradient(180deg,rgba(255,255,255,0.02),rgba(255,255,255,0.01));
      border:1px solid rgba(255,255,255,0.03);
    }

    .daily-header{
      font-size:20px;           /* increased size */
      color:var(--accent);
      font-weight:800;
      margin-bottom:12px;
      letter-spacing:1.8px;
      text-transform:uppercase;
    }

    .daily{
      margin-bottom:12px;
      padding:0;
      border-radius:8px;
      background:transparent;
      border:0;
    }

    .daily-track{
      display:flex;
      align-items:center;
      gap:12px;
      padding:14px;
      border-radius:10px;
      background:linear-gradient(90deg,rgba(29,185,84,.06),rgba(10,150,200,.03));
      cursor:pointer;
    }
    .daily-track.active{outline:1px solid rgba(29,185,84,.12)}

    /* STREAM NOW button style */
    .stream-btn{
      background:linear-gradient(180deg,var(--accent),#0aa84a);
      color:#072012;
      border-radius:10px;
      padding:10px 18px;
      font-weight:700;
      box-shadow:0 6px 18px rgba(13,122,60,0.32);
      border:0;
      cursor:pointer;
      transition:transform .12s ease,opacity .12s ease;
    }
    .stream-btn:active{transform:translateY(1px) scale(.997)}
    .stream-btn.disabled{opacity:.7;pointer-events:none}

    /* Intro animations */
    .player { opacity: 0; transform: translateY(14px) scale(.995); }
    .player.intro-animate { animation: playerIntro .6s cubic-bezier(.2,.9,.3,1) forwards; }
    @keyframes playerIntro { from{opacity:0; transform:translateY(14px) scale(.995)} to{opacity:1; transform:none} }

    .cover.intro { animation: coverIntro .75s cubic-bezier(.2,.9,.3,1) forwards; transform-origin:center; }
    @keyframes coverIntro { from{transform:scale(.86) rotate(-2deg); filter:grayscale(60%); opacity:0} to{transform:scale(1) rotate(0); filter:none; opacity:1} }

    .title.intro, .artist.intro, .stream-btn.intro, .daily-track.intro, .track.intro{
      opacity:0; transform:translateY(10px); animation: itemFade .52s ease forwards;
    }
    @keyframes itemFade { from{opacity:0; transform:translateY(10px)} to{opacity:1; transform:none} }

    /* small stagger helper when JS doesn't set inline delay */
    .track.intro { animation-delay: 0ms; }
  </style>
  <script src="https://sdk.scdn.co/spotify-player.js"></script>
</head>
<body>
  <div class="player" role="application" aria-label="Music player">
    <div class="top">
      <div class="cover" id="cover">Cover</div>
      <div class="meta">
        <h1 class="title" id="track-title">Track Title</h1>
        <div class="artist" id="track-artist">Artist</div>
      </div>
    </div>

    <!-- STREAM NOW button (plays DAILY BEST) -->
    <div class="stream-wrap">
      <button id="stream" class="stream-btn" aria-label="Stream now">STREAM NOW</button>
    </div>

    <!-- DAILY BEST box (track 123) -->
    <div class="daily" id="daily">
      <div class="daily-header">DAILY BEST</div>
      <div class="daily-track" id="daily-track" role="button" tabindex="0"></div>
    </div>

    <div class="playlist" id="playlist" aria-label="Playlist">
      <!-- tracks added by JS -->
    </div>

    <audio id="audio"></audio>
  </div>

  <script>
    const tracks = [
      { 
        title: "Loading...", 
        artist: "Loading...", 
        src: "track1.mp3", 
        cover: "",
        spotifyUrl: "https://open.spotify.com/track/2plbrEY59IikOBgBGLjaoe?si=45eaa4984faf4f73",
        spotifyId: "2plbrEY59IikOBgBGLjaoe"
      },
      { 
        title: "Track Two", 
        artist: "Artist B", 
        src: "track2.mp3", 
        cover: "",
        spotifyUrl: "https://open.spotify.com/track/1Yk0cQdMLx5RzzFTYwmuld?si=8e444883506243cd",
        spotifyId: "1Yk0cQdMLx5RzzFTYwmuld"
      },
      { 
        title: "Track Three", 
        artist: "Artist C", 
        src: "track3.mp3", 
        cover: "",
        spotifyUrl: "https://open.spotify.com/track/5kqIPrATaCc2LqxVWzQGbk?si=5f8838872ff946a5",
        spotifyId: "5kqIPrATaCc2LqxVWzQGbk"
      },
      { 
        title: "Track Four", 
        artist: "Artist D", 
        src: "track4.mp3", 
        cover: "",
        spotifyUrl: "https://open.spotify.com/track/6Mkj948t1Rvf8Zr9cgE1oE?si=d5cd5b93da4a4b91",
        spotifyId: "6Mkj948t1Rvf8Zr9cgE1oE"
      },
      { 
        title: "Track Five", 
        artist: "Artist E", 
        src: "track5.mp3", 
        cover: "",
        spotifyUrl: "https://open.spotify.com/track/7hTHmwcjrwgqm9gmwfSJzF?si=362c240a006a48bc",
        spotifyId: "7hTHmwcjrwgqm9gmwfSJzF"
      }
    ];
    // Select the DAILY BEST by file name (change to your file name) or fallback to index 2
    const dailySrc = "track123.mp3";
    let dailyIndex = tracks.findIndex(t => t.src === dailySrc);
    if (dailyIndex === -1) dailyIndex = 2; // fallback if filename not found

    const audio = document.getElementById('audio');
    const streamBtn = document.getElementById('stream');
    const progress = document.getElementById('progress');
    const bar = document.getElementById('bar');
    const cur = document.getElementById('cur');
    const dur = document.getElementById('dur');
    const loopBtn = document.getElementById('loop');
    const shuffleBtn = document.getElementById('shuffle');
    const titleEl = document.getElementById('track-title');
    const artistEl = document.getElementById('track-artist');
    const coverEl = document.getElementById('cover');
    const playlistEl = document.getElementById('playlist');
    const dailyTrackEl = document.getElementById('daily-track');

    let index = 0;
    let isPlaying = false;
    let isShuffle = false;

    function fmt(t){
      if (!isFinite(t)) return '0:00';
      const m = Math.floor(t/60), s = Math.floor(t%60);
      return m+':'+String(s).padStart(2,'0');
    }

    function loadTrack(i){
      index = (i + tracks.length) % tracks.length;
      const track = tracks[index];
      audio.src = track.src;
      titleEl.textContent = track.title;
      artistEl.textContent = track.artist;

      // show cover image if available, otherwise fallback to gradient + first word
      if (track.cover) {
        coverEl.style.background = `url("${track.cover}") center/cover no-repeat`;
        coverEl.textContent = '';
      } else {
        coverEl.style.background = 'linear-gradient(135deg,#0b2233,#122b3d)';
        coverEl.textContent = track.title ? (track.title.split(' ')[0] || 'Cover') : 'Cover';
      }
      
      // Update STREAM NOW button link
      if (streamBtn) {
        if (track.spotifyUrl) {
          streamBtn.onclick = (e) => {
            e.preventDefault();
            window.open(track.spotifyUrl, '_blank');
          };
          streamBtn.style.cursor = 'pointer';
        } else {
          streamBtn.onclick = toggleStream;
        }
      }
      
      updateActive();
      audio.load();
    }

    function toggleStream(){
      if (audio.paused) {
        audio.play().catch(()=>{});
      } else {
        audio.pause();
      }
    }

    audio.addEventListener('play', ()=>{
      isPlaying = true;
      if (streamBtn) streamBtn.textContent = 'STOP STREAM';
    });
    audio.addEventListener('pause', ()=>{
      isPlaying = false;
      if (streamBtn) streamBtn.textContent = 'STREAM NOW';
    });
    audio.addEventListener('timeupdate', ()=>{
      const pct = (audio.currentTime / (audio.duration||1)) * 100;
      if (bar) bar.style.width = pct + '%';
      if (cur) cur.textContent = fmt(audio.currentTime);
    });
    audio.addEventListener('loadedmetadata', ()=>{ if (dur) dur.textContent = fmt(audio.duration); });
    audio.addEventListener('ended', ()=>{
      if (audio.loop) { audio.play(); return; }
      if (isShuffle) nextTrackRandom(); else nextTrack();
    });

    // Remove the original stream button click handler
    // if (streamBtn) streamBtn.addEventListener('click', toggleStream);

    // keep prev/next logic for keyboard or future UI (no buttons shown)
    function prevTrack(){ loadTrack(index-1); audio.play().catch(()=>{}); }
    function nextTrack(){ loadTrack(index+1); audio.play().catch(()=>{}); }
    function nextTrackRandom(){ let idx = Math.floor(Math.random()*tracks.length); if (idx===index) idx=(idx+1)%tracks.length; loadTrack(idx); audio.play().catch(()=>{}); }

    if (progress) progress.addEventListener('click', (e)=>{
      const rect = progress.getBoundingClientRect();
      const pct = (e.clientX - rect.left) / rect.width;
      audio.currentTime = pct * (audio.duration || 0);
    });

    // removed volume event and references

    loopBtn && loopBtn.addEventListener('click', ()=>{ audio.loop = !audio.loop; loopBtn.style.opacity = audio.loop?1:0.6; });
    shuffleBtn && shuffleBtn.addEventListener('click', ()=>{ isShuffle = !isShuffle; shuffleBtn.style.opacity = isShuffle?1:0.6; });

    function updateActive(){
      // update daily
      if (dailyTrackEl) dailyTrackEl.classList.toggle('active', index === dailyIndex);

      // update playlist items (use dataset.index so indices map to tracks array)
      Array.from(playlistEl.children).forEach((el)=>{
        const i = Number(el.dataset.index);
        el.classList.toggle('active', i === index);
      });
    }

    function buildDaily(){
      if (!dailyTrackEl || dailyIndex < 0 || dailyIndex >= tracks.length) return;
      const t = tracks[dailyIndex];
      const thumbHtml = t.cover
        ? `<div style="width:56px;height:56px;border-radius:8px;background:url('${t.cover}') center/cover no-repeat;flex:0 0 56px"></div>`
        : `<div style="width:56px;height:56px;border-radius:8px;background:linear-gradient(135deg,#09202b,#0f3a3d);display:flex;align-items:center;justify-content:center;color:var(--muted);font-size:14px">★</div>`;
      dailyTrackEl.innerHTML = `${thumbHtml}
        <div style="flex:1"><div style="font-weight:600">${t.title}</div><div style="font-size:12px;color:var(--muted)">${t.artist}</div></div>
        <div style="color:var(--muted);font-size:12px">${t.src.split('.').pop().toUpperCase()}</div>`;
      dailyTrackEl.addEventListener('click', ()=>{ loadTrack(dailyIndex); audio.play().catch(()=>{}); });
      dailyTrackEl.addEventListener('keydown', (e)=>{ if (e.key === 'Enter' || e.key === ' ') { loadTrack(dailyIndex); audio.play().catch(()=>{}); }});
    }

    function buildPlaylist(){
      playlistEl.innerHTML = '';
      tracks.forEach((t,i)=>{
        if (i === dailyIndex) return; // skip the daily best item from the main playlist
        const thumbStyle = t.cover
          ? `background:url('${t.cover}') center/cover no-repeat`
          : 'background:linear-gradient(135deg,#09202b,#0f3a3d);display:flex;align-items:center;justify-content:center;color:var(--muted)';
        const thumbContent = t.cover ? '' : (i+1);
        const el = document.createElement('div');
        el.className = 'track';
        el.dataset.index = i; // keep original index so updateActive works
        el.innerHTML = `<div style="width:40px;height:40px;border-radius:6px;flex:0 0 40px;${thumbStyle};font-size:12px;display:flex;align-items:center;justify-content:center">${thumbContent}</div>
                        <div class="info">
                          <div class="name">${t.spotifyUrl ? `<a href="${t.spotifyUrl}" target="_blank" style="color:inherit;text-decoration:none">${t.title}</a>` : t.title}</div>
                          <div class="sub">${t.artist}</div>
                        </div>
                        <div class="filetype">${t.src.split('.').pop().toUpperCase()}</div>`;
        el.addEventListener('click', ()=>{ loadTrack(i); audio.play().catch(()=>{}); });
        playlistEl.appendChild(el);
      });
      updateActive();
    }

    async function fetchSpotifyTrackInfo() {
      // Fetch metadata for all tracks that include spotifyId (Track 1 and Track 2)
      const clientId = '4532cd63faa245b09c756aa4a1c54394';
      const clientSecret = 'a04a9dd0636e460fb10519c244db1009';
      try {
        const tokenResponse = await fetch('https://accounts.spotify.com/api/token', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'Authorization': 'Basic ' + btoa(clientId + ':' + clientSecret)
          },
          body: 'grant_type=client_credentials'
        });
        const tokenData = await tokenResponse.json();
        const token = tokenData.access_token;

        const fetches = tracks.map(async (t, i) => {
          if (!t.spotifyId) return;
          try {
            const res = await fetch(`https://api.spotify.com/v1/tracks/${t.spotifyId}`, {
              headers: { 'Authorization': 'Bearer ' + token }
            });
            if (!res.ok) return;
            const d = await res.json();
            tracks[i].title = d.name || tracks[i].title;
            tracks[i].artist = (d.artists && d.artists[0] && d.artists[0].name) || tracks[i].artist;
            tracks[i].cover = (d.album && d.album.images && d.album.images[0] && d.album.images[0].url) || tracks[i].cover;
          } catch (err) {
            console.warn('spotify fetch failed for', t.spotifyId, err);
          }
        });

        await Promise.all(fetches);

        // Rebuild UI after metadata fetch
        buildPlaylist();
        buildDaily();

        // If current track has new cover/info, update player header
        const current = tracks[index];
        if (current) {
          titleEl.textContent = current.title;
          artistEl.textContent = current.artist;
          if (current.cover) {
            coverEl.style.background = `url(${current.cover}) center/cover`;
            coverEl.textContent = '';
          }
        }

      } catch (error) {
        console.error('Error fetching Spotify data:', error);
      }
    }

    // intro animation sequence
    function runIntroAnimation(){
      const playerEl = document.querySelector('.player');
      if (!playerEl) return;
      playerEl.classList.add('intro-animate');

      // cover -> title/artist -> stream -> daily -> playlist (stagger)
      const cover = document.getElementById('cover');
      const title = document.getElementById('track-title');
      const artist = document.getElementById('track-artist');
      const stream = document.getElementById('stream');
      const daily = document.getElementById('daily-track');
      const playlistItems = Array.from(document.querySelectorAll('.playlist .track'));

      setTimeout(()=>{ cover && cover.classList.add('intro'); }, 180);
      setTimeout(()=>{ title && title.classList.add('intro'); artist && artist.classList.add('intro'); }, 360);
      setTimeout(()=>{ stream && stream.classList.add('intro'); }, 520);
      setTimeout(()=>{ daily && daily.classList.add('intro'); }, 700);

      playlistItems.forEach((it, i) => {
        it.style.animationDelay = (820 + i * 70) + 'ms';
        setTimeout(()=> it.classList.add('intro'), 820 + i * 70);
      });
    }

    // position STREAM NOW slightly below the cover image
    function positionStreamButton(){
      const streamWrap = document.querySelector('.stream-wrap');
      const cover = document.getElementById('cover');
      if (!streamWrap || !cover) return;
      const h = cover.offsetHeight || 160;
      // set offset ~12% of cover height but at least 8px
      const offset = Math.max(8, Math.round(h * 0.12));
      streamWrap.style.marginTop = offset + 'px';
    }

    window.addEventListener('resize', positionStreamButton);

    // Initialize
    buildDaily();
    buildPlaylist();
    loadTrack(0);
    // fetch metadata then run intro animation
    fetchSpotifyTrackInfo().finally(() => {
      // rebuild UI in case fetch updated titles/covers
      buildPlaylist();
      buildDaily();
      loadTrack(index);
      // small delay so elements exist/render before animation
      setTimeout(()=>{
        runIntroAnimation();
        positionStreamButton(); // adjust STREAM NOW position after layout
      }, 120);
    });
  </script>
</body>
</html>